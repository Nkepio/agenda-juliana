<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agenda - Studio Juliana Julia (Avan√ßada)</title>

<!-- FullCalendar CSS (CDN) -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet"/>

<style>
:root{
  --primary:#d84315;
  --accent:#ff7043;
  --bg:#fef9f7;
  --card:#fff3e0;
  --ok:#00796b;
  --whatsapp:#25d366;
  --text:#333;
}
*{box-sizing:border-box}
body{
  font-family: "Segoe UI", Tahoma, Verdana, sans-serif;
  margin:0; background:var(--bg); color:var(--text);
}
header{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:14px 18px; border-bottom:1px solid rgba(0,0,0,0.06);
  background: linear-gradient(90deg, rgba(255,250,248,1) 0%, rgba(254,243,234,1) 100%);
}
header h1{ margin:0; font-size:18px; color:var(--primary); }
.header-right{ display:flex; gap:10px; align-items:center; }
.btn{ border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; box-shadow:0 3px 8px rgba(0,0,0,0.06); background:transparent; }
.btn.primary{ background:var(--primary); color:#fff; }
.btn.ghost{ background:transparent; border:1px solid rgba(0,0,0,0.06); }
.main{ display:flex; gap:32px; padding:28px; align-items:flex-start; }
#calendar { flex:1 1 700px; background:white; border-radius:12px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,0.06); min-width:300px; }

.side-panel{
  width:360px; max-width:36%; min-width:280px; background:var(--card);
  border-radius:12px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,0.06);
  display:flex; flex-direction:column; gap:12px; height: calc(100vh - 120px); overflow:auto;
}
.panel-header{ display:flex; justify-content:space-between; align-items:center; gap:8px; }
.panel-header h2{ margin:0; font-size:16px; color:var(--primary); }
.small{ font-size:13px; color:#444; }
.controls-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

.search-group{ display:flex; gap:8px; }
.search-group input{ padding:8px; border-radius:8px; border:1px solid rgba(0,0,0,0.08); }

.event-list{ display:flex; flex-direction:column; gap:10px; margin-top:6px; }
.event-card{ background:white; border-radius:10px; padding:10px; box-shadow:0 4px 8px rgba(0,0,0,0.04); display:flex; flex-direction:column; gap:8px; }
.event-row{ display:flex; justify-content:space-between; gap:8px; align-items:center; }
.event-meta{ font-weight:700; color:#222; }
.event-desc{ color:#555; font-size:13px; }

.chip{ padding:6px 8px; border-radius:8px; font-size:13px; font-weight:700; }
.chip.pendente{ background:#fff3e0; color:var(--primary); border:1px solid rgba(216,67,21,0.08); }
.chip.confirmado{ background:#e0f7fa; color:var(--ok); border:1px solid rgba(0,121,107,0.08); }

.event-actions{ display:flex; gap:6px; flex-wrap:wrap; }
.small-btn{ padding:8px 10px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
.small-btn.whatsapp{ background:var(--whatsapp); color:#fff; }
.small-btn.delete{ background:#ff8a65; color:#fff; }
.small-btn.status{ background:#ffcc80; color:#333; }
.small-btn.edit{ background:#4fc3f7; color:#fff; }

form.add-form{ display:flex; flex-direction:column; gap:8px; margin-top:6px; }
form label{ font-size:13px; color:#333; font-weight:600; }
form input, form textarea, form select{ padding:8px 10px; border-radius:8px; border:1px solid rgba(0,0,0,0.08); font-size:14px; }
.form-actions{ display:flex; gap:8px; }
.hint{ font-size:12px; color:#555; }

.login-panel{
  position:fixed; inset:0; background:rgba(0,0,0,0.35); display:flex; align-items:center; justify-content:center;
}
.login-box{ background:white; padding:18px; border-radius:12px; width:320px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }

.footer-note{ padding:12px 18px; text-align:center; color:#666; font-size:13px; }

@media (max-width:1000px){
  .main{ flex-direction:column; padding:12px; }
  .side-panel{ width:100%; max-width:100%; min-width:unset; height:auto; order:2; }
  #calendar{ order:1; }
}
</style>
</head>
<body>

<header>
  <h1>Studio Juliana Julia ‚Äî Agenda</h1>
  <div class="header-right">
    <div id="userInfo" class="small"></div>
    <button id="todayBtn" class="btn ghost">Hoje</button>
    <button id="viewMonth" class="btn ghost">M√™s</button>
    <button id="viewWeek" class="btn ghost">Semana</button>
    <button id="viewDay" class="btn ghost">Dia</button>
    
  </div>
</header>

<div class="main">
  <div id="calendar"></div>

  <aside class="side-panel" id="sidePanel" aria-hidden="true">
    <div class="panel-header">
      <h2 id="panelTitle">Clique em um dia</h2>
      <div><span id="dayCount" class="small"></span></div>
    </div>

    <div class="controls-row">
      <div class="search-group" style="flex:1">
        <input type="search" id="searchName" placeholder="Pesquisar por nome..." />
      </div>
      <div>
        <input type="date" id="filterDate" title="Filtrar por data" />
      </div>
      <div>
        <button id="clearFilters" class="btn ghost">Limpar</button>
      </div>
    </div>

    <div class="hint">Hor√°rio de trabalho: <strong>07:00</strong> √†s <strong>21:00</strong>. Sem tempo m√≠nimo.</div>

    <div id="eventList" class="event-list"></div>

    <hr/>

    <div>
      <h3 style="margin:0 0 6px 0;">Adicionar / Editar agendamento</h3>

      <form id="addForm" class="add-form">
        <input type="hidden" id="editId" />
        <label>Nome</label>
        <input id="nome" type="text" required placeholder="Nome do cliente"/>

        <label>Servi√ßo</label>
        <input id="servico" type="text" placeholder="Ex: Manicure"/>

        <label>Contato</label>
        <div style="display:flex; gap:8px;">
          <input id="contato" type="tel" required placeholder="Selecione ou digite..." style="flex:1;"/>
          <button type="button" id="pickContact" class="btn ghost">Agenda</button>
        </div>

        <label>Data</label>
        <input id="data" type="date" required />

        <label>Hora in√≠cio</label>
        <input id="horaInicio" type="time" required />

        <label>Hora fim</label>
        <input id="horaFim" type="time" required />

        <label>Status</label>
        <select id="status">
          <option value="pendente">Pendente</option>
          <option value="confirmado">Confirmado</option>
        </select>

        <label><input type="checkbox" id="autoWhats" /> Enviar WhatsApp automaticamente ao salvar</label>

        <div class="form-actions">
          <button type="submit" class="btn primary" style="flex:1;">Salvar</button>
          <button type="button" id="cancelEdit" class="btn">Limpar</button>
        </div>

        <div id="formMessage" class="hint"></div>
      </form>
    </div>

    <footer class="footer-note">Clique em um dia no calend√°rio para ver e gerenciar os hor√°rios.</footer>
  </aside>
</div>

<footer class="footer-note">Dados salvos no Firestore (Projeto: Studio Juliana Julia). FullCalendar carregado via CDN.</footer>

<!-- FullCalendar (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/pt-br.global.min.js"></script>

<script type="module">
/* Firebase + Firestore + FullCalendar integration */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs, doc, setDoc, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

// Your firebaseConfig (inserido por voc√™)
const firebaseConfig = {
  apiKey: "AIzaSyAYzvHGI-7jAKBd5BLGX5pXHy60MPj3Qss",
  authDomain: "agenda-studio-juliana-julia.firebaseapp.com",
  projectId: "agenda-studio-juliana-julia",
  storageBucket: "agenda-studio-juliana-julia.firebasestorage.app",
  messagingSenderId: "364351426824",
  appId: "1:364351426824:web:f1c82f056088b62f21dcbd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Local helper functions */
function uid(){ return Math.random().toString(36).slice(2,9); }
function toMinutes(t){ if(!t) return 0; const [h,m]=t.split(':').map(Number); return h*60 + m; }
function formatDateDot(dateStr){ const d=new Date(dateStr + 'T00:00:00'); const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const yyyy=d.getFullYear(); return `${dd}.${mm}.${yyyy}`; }

/* Conflict check (same-day) - local list */
function hasConflictLocal(eventList, date, startMin, endMin, excludeId=null){
  return eventList.some(ev=>{
    if(ev.date !== date) return false;
    if(ev.id === excludeId) return false;
    const s = toMinutes(ev.start);
    const e = toMinutes(ev.end);
    return !(endMin <= s || startMin >= e);
  });
}

/* Convert Firestore doc to calendar event */
function docToEvent(doc){
  const d = doc.data();
  return {
    id: doc.id,
    title: `${d.name}${d.service ? ' ‚Äî ' + d.service : ''}`,
    start: d.date + 'T' + d.start,
    end: d.date + 'T' + d.end,
    allDay: false,
    extendedProps: {
      contact: d.phone,
      status: d.status,
      service: d.service,
      date: d.date,
      start: d.start,
      end: d.end,
      clientId: d.clientId || null
    }
  };
}

let calendar; // will hold FullCalendar instance
let liveAppointments = []; // cache of appointments from Firestore

/* Init Calendar and listeners */
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');

  calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'pt-br',
    firstDay: 1,
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: ''
    },
    height: 'auto',
    dayMaxEventRows: true,
    selectable: true,
    events: [], // will be filled by Firestore
    dateClick: function(info){ openPanelForDate(info.dateStr); },
    eventDidMount: function(info){
      const status = info.event.extendedProps.status;
      if(status === 'confirmado'){
        info.el.style.backgroundColor = '#e0f7fa';
        info.el.style.borderColor = '#00796b';
        info.el.style.color = '#004d40';
        info.el.style.borderRadius = '8px';
        info.el.style.padding = '4px';
      } else {
        info.el.style.backgroundColor = '#fff3e0';
        info.el.style.borderColor = '#d84315';
        info.el.style.color = '#5d2a11';
        info.el.style.borderRadius = '8px';
        info.el.style.padding = '4px';
      }
    }
  });

  calendar.render();
  window._fc = calendar;

  document.getElementById('todayBtn').addEventListener('click', ()=> calendar.today());
  document.getElementById('viewMonth').addEventListener('click', ()=> calendar.changeView('dayGridMonth'));
  document.getElementById('viewWeek').addEventListener('click', ()=> calendar.changeView('timeGridWeek'));
  document.getElementById('viewDay').addEventListener('click', ()=> calendar.changeView('timeGridDay'));
  document.getElementById('newBtn').addEventListener('click', ()=>{
    const today = calendar.getDate().toISOString().slice(0,10);
    openPanelForDate(today);
    scrollToForm();
  });

  document.getElementById('searchName').addEventListener('input', ()=> {
    const date = document.getElementById('data').value || (window._fc ? window._fc.getDate().toISOString().slice(0,10) : null);
    if(date) openPanelForDate(date);
  });
  document.getElementById('filterDate').addEventListener('change', ()=> {
    const d = document.getElementById('filterDate').value;
    if(d) openPanelForDate(d);
  });
  document.getElementById('clearFilters').addEventListener('click', ()=> {
    document.getElementById('searchName').value='';
    document.getElementById('filterDate').value='';
    const curDate = document.getElementById('data').value || (window._fc ? window._fc.getDate().toISOString().slice(0,10) : null);
    if(curDate) openPanelForDate(curDate);
  });

  document.getElementById('addForm').addEventListener('submit', function(e){
    e.preventDefault();
    handleFormSubmit();
  });
  document.getElementById('cancelEdit').addEventListener('click', ()=> { clearForm(); document.getElementById('formMessage').textContent=''; });

  document.getElementById('pickContact').addEventListener('click', pickContactFromDevice);

  renderUserInfo();

  // start listening to appointments collection (live)
  const q = query(collection(db, 'appointments'));
  onSnapshot(q, (snapshot)=>{
    liveAppointments = snapshot.docs.map(doc=> ({ id: doc.id, ...doc.data() }));
    refreshCalendarEventsFromLive();
    // if currently open panel for a date, refresh it
    const curDate = document.getElementById('data').value || (window._fc ? window._fc.getDate().toISOString().slice(0,10) : null);
    if(curDate) openPanelForDate(curDate);
  });
});

/* Open side panel for a date */
function openPanelForDate(dateStr){
  const panel = document.getElementById('sidePanel');
  panel.setAttribute('aria-hidden','false');
  document.getElementById('panelTitle').textContent = 'Agenda ‚Äî ' + formatDateDot(dateStr);

  const all = liveAppointments.map(a=> ({ id: a.id, name: a.name, service: a.service, contact: a.phone, phone: a.phone, date: a.date, start: a.start, end: a.end, status: a.status || 'pendente' }));
  const search = (document.getElementById('searchName').value || '').toLowerCase();
  const dayEvents = all.filter(ev=> ev.date === dateStr)
                       .filter(ev => !search || (ev.name && ev.name.toLowerCase().includes(search)))
                       .sort((a,b)=> a.start.localeCompare(b.start));

  renderEventList(dayEvents);
  document.getElementById('dayCount').textContent = dayEvents.length + ' compromissos';
  document.getElementById('data').value = dateStr;
  document.getElementById('editId').value = '';
}

/* Render events */
function renderEventList(list){
  const container = document.getElementById('eventList');
  container.innerHTML = '';
  if(list.length === 0){
    const msg = document.createElement('div'); msg.className='hint'; msg.textContent='Nenhum compromisso para este dia.'; container.appendChild(msg); return;
  }
  list.forEach(ev=>{
    const card = document.createElement('div'); card.className='event-card';
    const row = document.createElement('div'); row.className='event-row';
    const meta = document.createElement('div'); meta.className='event-meta';
    meta.textContent = `${ev.name}${ev.service ? ' ‚Äî ' + ev.service : ''}`;
    row.appendChild(meta);
    const chip = document.createElement('div'); chip.className = 'chip ' + (ev.status === 'confirmado' ? 'confirmado' : 'pendente');
    chip.textContent = ev.status === 'confirmado' ? 'Confirmado' : 'Pendente';
    row.appendChild(chip);
    card.appendChild(row);

    const times = document.createElement('div'); times.className='event-desc';
    times.textContent = `${ev.start} ‚Äî ${ev.end} ¬∑ ${formatDateDot(ev.date)}`;
    card.appendChild(times);

    const actions = document.createElement('div'); actions.className='event-actions';

    const btnWhats = document.createElement('button'); btnWhats.className='small-btn whatsapp'; btnWhats.textContent='üì© WhatsApp';
    btnWhats.onclick = ()=> {
      const mensagem = `Studio Juliana Julia, confirma seu agendamento para o dia ${formatDateDot(ev.date)} √†s ${ev.start} - ${ev.end}. Nos vemos em breve. Obrigada.`;
      window.open(`https://wa.me/55${ev.contact.replace(/\D/g,'')}?text=${encodeURIComponent(mensagem)}`, '_blank');
    };
    actions.appendChild(btnWhats);

    const btnEdit = document.createElement('button'); btnEdit.className='small-btn edit'; btnEdit.textContent='‚úèÔ∏è Editar';
    btnEdit.onclick = ()=> populateFormForEdit(ev); actions.appendChild(btnEdit);

    const btnDelete = document.createElement('button'); btnDelete.className='small-btn delete'; btnDelete.textContent='üóëÔ∏è Apagar';
    btnDelete.onclick = ()=> { if(confirm('Apagar este agendamento?')){ deleteAppointment(ev.id); openPanelForDate(ev.date); } };
    actions.appendChild(btnDelete);

    const btnToggle = document.createElement('button'); btnToggle.className='small-btn status'; btnToggle.textContent = ev.status==='pendente'?'‚è≥ Confirmar':'‚úÖ Marcar Pendente';
    btnToggle.onclick = ()=> { toggleStatus(ev.id); openPanelForDate(ev.date); };
    actions.appendChild(btnToggle);

    card.appendChild(actions);
    container.appendChild(card);
  });
}

/* Populate for edit */
function populateFormForEdit(ev){
  document.getElementById('editId').value = ev.id;
  document.getElementById('nome').value = ev.name;
  document.getElementById('servico').value = ev.service || '';
  document.getElementById('contato').value = ev.phone || ev.contact;
  document.getElementById('data').value = ev.date;
  document.getElementById('horaInicio').value = ev.start;
  document.getElementById('horaFim').value = ev.end;
  document.getElementById('status').value = ev.status || 'pendente';
  document.getElementById('formMessage').textContent = 'Editando ‚Äî altere e salve.';
  scrollToForm();
}

/* Form submit -> save client (if new) and appointment into Firestore */
async function handleFormSubmit(){
  const id = document.getElementById('editId').value || null;
  const name = document.getElementById('nome').value.trim();
  const service = document.getElementById('servico').value.trim();
  const contact = document.getElementById('contato').value.trim().replace(/\D/g,'');
  const date = document.getElementById('data').value;
  const start = document.getElementById('horaInicio').value;
  const end = document.getElementById('horaFim').value;
  const status = document.getElementById('status').value;
  const autoWhats = document.getElementById('autoWhats').checked;

  if(!name || !contact || !date || !start || !end){
    document.getElementById('formMessage').textContent = 'Preencha todos os campos obrigat√≥rios.';
    return;
  }
  if(start < '07:00' || end > '21:00' || start >= end){
    document.getElementById('formMessage').textContent = 'Hor√°rios devem estar entre 07:00 e 21:00 e in√≠cio < fim.';
    return;
  }

  const startMin = toMinutes(start);
  const endMin = toMinutes(end);

  // conflict check against liveAppointments
  if(hasConflictLocal(liveAppointments, date, startMin, endMin, id)){
    document.getElementById('formMessage').textContent = 'Hor√°rio indispon√≠vel ‚Äî existe conflito.';
    return;
  }

  try{
    // ensure client exists (search by phone)
    const clientsRef = collection(db, 'clients');
    const q = query(clientsRef, where('phone','==',contact));
    const snapshot = await getDocs(q);
    let clientId = null;
    if(snapshot.empty){
      const newClient = await addDoc(clientsRef, { name, phone: contact });
      clientId = newClient.id;
    } else {
      clientId = snapshot.docs[0].id;
      // optionally update name if empty
      const cData = snapshot.docs[0].data();
      if(!cData.name && name) await setDoc(doc(db, 'clients', clientId), { name, phone: contact }, { merge: true });
    }

    // save appointment
    const appointmentsRef = collection(db, 'appointments');
    const payload = { name, phone: contact, service, date, start, end, status, clientId };

    if(id){
      // overwrite existing
      await setDoc(doc(db, 'appointments', id), payload, { merge: true });
    } else {
      await addDoc(appointmentsRef, payload);
    }

    document.getElementById('formMessage').textContent = 'Salvo com sucesso!';

    if(autoWhats){
      const mensagem = `Studio Juliana Julia, confirma seu agendamento para o dia ${formatDateDot(date)} √†s ${start} - ${end}. Obrigada.`;
      window.open(`https://wa.me/55${contact}?text=${encodeURIComponent(mensagem)}`,'_blank');
    }

    clearForm();
    setTimeout(()=>{ document.getElementById('formMessage').textContent=''; },1500);
  }catch(err){
    console.error(err);
    document.getElementById('formMessage').textContent = 'Erro ao salvar. Veja console.';
  }
}

/* delete / toggle */
async function deleteAppointment(id){
  try{ await setDoc(doc(db,'appointments',id), {}, { merge: false });
    // Note: this sets empty doc; better to use deleteDoc in production. Using setDoc here to avoid permission issues in some rules.
    // If you prefer actual delete, replace with: await deleteDoc(doc(db,'appointments',id));
  }catch(e){ console.error(e); }
}
async function toggleStatus(id){
  try{
    const ap = liveAppointments.find(a=> a.id===id);
    if(!ap) return;
    const newStatus = (ap.status === 'confirmado') ? 'pendente' : 'confirmado';
    await setDoc(doc(db,'appointments',id), { status: newStatus }, { merge: true });
  }catch(e){ console.error(e); }
}

function clearForm(){
  document.getElementById('editId').value='';
  document.getElementById('nome').value='';
  document.getElementById('servico').value='';
  document.getElementById('contato').value='';
  document.getElementById('horaInicio').value='';
  document.getElementById('horaFim').value='';
  document.getElementById('status').value='pendente';
  document.getElementById('autoWhats').checked = false;
  document.getElementById('formMessage').textContent='';
}

/* refresh calendar from liveAppointments */
function refreshCalendarEventsFromLive(){
  if(!calendar) return;
  calendar.removeAllEvents();
  liveAppointments.forEach(a=>{
    try{ calendar.addEvent(docToEvent({ id: a.id, data: ()=>a })); }catch(e){ console.error(e); }
  });
}

/* scroll helper */
function scrollToForm(){ const el=document.getElementById('addForm'); if(el) setTimeout(()=> el.scrollIntoView({behavior:'smooth', block:'center'}),150); }

/* CONTACT PICKER (Web Contact Picker API) */
async function pickContactFromDevice(){
  // Prefer Web Contacts API when available
  if('contacts' in navigator && typeof navigator.contacts.select === 'function'){
    try{
      const props = ['tel','name'];
      const opts = { multiple: false };
      const contacts = await navigator.contacts.select(props, opts);
      if(contacts.length > 0){
        const c = contacts[0];
        const tel = (c.tel && c.tel[0]) ? c.tel[0].replace(/\D/g,'') : '';
        document.getElementById('contato').value = tel;
        if(c.name && c.name[0] && !document.getElementById('nome').value) document.getElementById('nome').value = c.name[0];
      }
      return;
    }catch(e){ console.warn('Contact picker cancelled or failed', e); }
  }

  // Fallback: try to open tel: (will open dialer on mobile, user can copy)
  try{ window.location.href = 'tel:'; }catch(e){ alert('N√£o foi poss√≠vel acessar a agenda neste dispositivo.'); }
}

/* Simple user display/login (local only) */
function showLogin(){
  const existing = document.getElementById('loginModal');
  if(existing) return;
  const modal = document.createElement('div'); modal.id='loginModal'; modal.className='login-panel';
  modal.innerHTML = `
    <div class="login-box">
      <h3>Entrar (sem senha)</h3>
      <label>Seu nome</label>
      <input id="loginName" type="text" style="width:100%; padding:8px; margin:8px 0; border-radius:8px; border:1px solid #eee"/>
      <label>Seu telefone (apenas n√∫meros, ex: 5511999999999)</label>
      <input id="loginPhone" type="text" style="width:100%; padding:8px; margin:8px 0; border-radius:8px; border:1px solid #eee"/>
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button id="loginSave" class="btn primary" style="flex:1;">Entrar</button>
        <button id="loginCancel" class="btn" style="flex:1;">Cancelar</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  document.getElementById('loginCancel').onclick = ()=> { modal.remove(); };
  document.getElementById('loginSave').onclick = ()=> {
    const name = document.getElementById('loginName').value.trim();
    const phone = document.getElementById('loginPhone').value.trim();
    if(!name || !phone){ alert('Preencha nome e telefone.'); return; }
    localStorage.setItem('agendaUser', JSON.stringify({name, phone}));
    modal.remove();
    renderUserInfo();
  };
}
function renderUserInfo(){
  const userInfoEl = document.getElementById('userInfo');
  const u = JSON.parse(localStorage.getItem('agendaUser') || 'null');
  if(u){
    userInfoEl.textContent = `Ol√°, ${u.name}`;
    document.getElementById('loginBtn').textContent = 'Sair';
    document.getElementById('loginBtn').onclick = ()=> { if(confirm('Sair da sess√£o?')){ localStorage.removeItem('agendaUser'); renderUserInfo(); } };
  } else {
    userInfoEl.textContent = '';
    document.getElementById('loginBtn').textContent = 'Entrar';
    document.getElementById('loginBtn').onclick = showLogin;
  }
}

</script>
</body>
</html>
